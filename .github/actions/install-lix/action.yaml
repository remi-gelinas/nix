name: Install Lix

runs:
  using: "composite"
  steps:
    - name: Get system for installer URL
      shell: bash
      id: get-system
      run: |
        # No associative arrays because M1 runners have Bash 3 :(

        runner_index() {
          case $1 in
          'Linux_X64') return 0 ;;
          'Linux_ARM64') return 1 ;;
          'macOS_X64') return 2 ;;
          'macOS_ARM64') return 3 ;;
          esac
        }

        runner_systems=("x86_64-linux" "aarch64-linux" "x86_64-darwin" "aarch64-darwin")

        runner_index "${RUNNER_OS}_${RUNNER_ARCH}"
        system="${runner_systems[$?]}"

        echo "system=$system" >> "$GITHUB_OUTPUT"
    - uses: DeterminateSystems/nix-installer-action@v13
      with:
        source-url: https://install.lix.systems/lix/lix-installer-${{ steps.get-system.outputs.system }}
        diagnostic-endpoint: ""
